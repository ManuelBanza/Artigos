<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Cidade dos 15 Minutos</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<!-- Mapbox GL JS -->
<script src="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js"></script>
<link
  href="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.css"
  rel="stylesheet"
/>
<style>
	body { margin: 0; padding: 0; }
	#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
<!-- Mapbox Assembly -->
<link
  href="https://api.mapbox.com/mapbox-assembly/v1.3.0/assembly.min.css"
  rel="stylesheet"
/>
<script src="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js"></script>
<style>
    #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
    }
    #map-overlay {
        position: absolute;
        bottom: 35px;
        left: 10px;
        color: black;
        font-family: sans-serif;
        font-size: 15px;
        z-index: 1;
    }
</style>
</head>

<body>

<!-- Load the `mapbox-gl-geocoder` plugin. -->
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css" type="text/css">
<script src="https://unpkg.com/@turf/turf/turf.min.js"></script>

    <div id="map"></div>
    

    <div class="absolute fl my24 mx24 py24 px24 bg-gray-faint round">
      <form id="params">
        <h4 class="txt-m txt-bold mb6">Escolha um modo:</h4>
        <div class="mb12 mr12 toggle-group align-center">
          <label class="toggle-container">
            <input name="profile" type="radio" value="walking" checked />
            <div class="toggle toggle--active-null toggle--null">A pé</div>
          </label>
          <label class="toggle-container">
            <input name="profile" type="radio" value="cycling" />
            <div class="toggle toggle--active-null toggle--null">Bicicleta</div>
          </label>
        </div>
        <h4 class="txt-m txt-bold mb6">Escolha o máximo de:</h4>
        <div class="mb12 mr12 toggle-group align-center">
          <label class="toggle-container">
            <input name="duration" type="radio" value="15" checked />
            <div class="toggle toggle--active-null toggle--null">15 min</div>
          </label>
          <label class="toggle-container">
            <input name="duration" type="radio" value="10" />
            <div class="toggle toggle--active-null toggle--null">10 min</div>
          </label>
        </div>
      </form>
    </div>
    
    <div id='map-overlay'>Desenvolvido por: Manuel Banza<br/><a href="https://manuelbanza.github.io">manuelbanza.github.io</a></div>

    <script>
      mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYXNwdWJsaWNvcyIsImEiOiJjbGZoN3c3emgxdm11M3hwZzQ2dnN2MmZiIn0.hVRN47qVJ6KAMM_uVLJOBg';

      const map = new mapboxgl.Map({
        container: 'map', // container id
        style: 'mapbox://styles/mapbox/streets-v11', // stylesheet
        center: [-9.1375946, 38.7331092], // starting position [lng, lat]
        zoom: 11.5 // starting zoom
      });

      // Target the params form in the HTML
      const params = document.getElementById('params');

      // Create variables to use in getIso()
      const urlBase = 'https://api.mapbox.com/isochrone/v1/mapbox/';
      const lon = -9.1375946;
      const lat = 38.7331092;
      let profile = 'walking';
      let minutes = 15;
      let coords = "-9.1375946,38.7331092";


      // Set up a marker that you can use to show the query's coordinates
      const marker = new mapboxgl.Marker({
        'color': '#314ccd'
      });

      // Create a LngLat object to use in the marker initialization
      // https://docs.mapbox.com/mapbox-gl-js/api/#lnglat
      const lngLat = {
        lon: lon,
        lat: lat
      };

      const geocoder = new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
        mapboxgl: mapboxgl
      });

      map.addControl(geocoder, "top-right");

      // Create a function that sets up the Isochrone API query then makes a fetch call
      async function getIso() {
        const query = await fetch(
          `${urlBase}${profile}/${coords}?contours_minutes=${minutes}&polygons=true&access_token=${mapboxgl.accessToken}`,
          { method: 'GET' }
        );
        const data = await query.json();
        // Set the 'iso' source's data to what's returned by the API query
        map.getSource('iso').setData(data);
      }

      // When a user changes the value of profile or duration by clicking a button, change the parameter's value and make the API query again
      params.addEventListener('change', (event) => {
        if (event.target.name === 'profile') {
          profile = event.target.value;
        } else if (event.target.name === 'duration') {
          minutes = event.target.value;
        }
        getIso();
      });

      map.on('load', () => {
        // When the map loads, add the source and layer
        map.addSource('iso', {
          type: 'geojson',
          data: {
            'type': 'FeatureCollection',
            'features': []
          }
        });

        map.addLayer(
          {
            'id': 'isoLayer',
            'type': 'fill',
            'source': 'iso',
            'layout': {},
            'paint': {
              'fill-color': '#5a3fc0',
              'fill-opacity': 0.3
            }
          },
          'poi-label'
        );

        map.addLayer({
          "id": "pointsLayer",
          "type": "circle",
          "source": "points",
          "layout": {},
          "paint": {
            "circle-color": "blue",
          }
        }, "poi-label");

        // Add source and layer for the selected point data
        map.addSource("selection", {
          type: "geojson",
          data: {
            type: "FeatureCollection",
            features: [
            ]
          }
        });

        map.addLayer({
          "id": "selectionLayer",
          "type": "circle",
          "source": "selection",
          "layout": {},
          "paint": {
            "circle-color": "purple",
          }
        });

        // Ciclovias
        map.addSource('ciclovias', {
            type: 'geojson',
            data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/Ciclovias/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson'
        });

        map.addLayer({
            'id': 'ciclovias_lines',
            'type': 'line',
            'source': 'ciclovias',
            'layout': {
                'line-join': 'round',
                'line-cap': 'round',
            },
            'paint': {
                'line-color': '#008000',
                'line-width': 1.5
            }
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'ciclovias_lines', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(feature.properties.TIPOLOGIA);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'ciclovias_lines', function() {
            popup.remove();
        });

        // Clinicas de Saude
        map.addSource('poi_saude', {
            type: 'geojson',
            data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/POISaude/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson'
        });

        map.addLayer({
            'id': 'poi_saude_markers',
            'type': 'symbol',
            'source': 'poi_saude',
            'layout': {
              'icon-image': 'clinica_saude_icon',
              'icon-size': 0.042,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#fff'
            }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/clinica_saude.png', function(error, image) {
          if (error) throw error;
          map.addImage('clinica_saude_icon', image);
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'poi_saude_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(feature.properties.INF_NOME);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'poi_saude_markers', function() {
            popup.remove();
        });




        // Define the source for the Univ layer
        map.addSource('Univ', {
          type: 'geojson',
          data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/POIEducacao/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson'
          });

        // Add the Univ layer to the map
        map.addLayer({
          'id': 'Univ',
          'type': 'symbol',
          'source': 'Univ',
          'layout': {
              'icon-image': 'college-15',
              'icon-size': 0.8,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#fff'
            }
        });


        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'Univ', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the NOME attribute
            popup.setHTML(feature.properties.INF_NOME);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'Univ', function() {
            popup.remove();
        });


        // GIRA
        map.addSource('gira', {
            type: 'geojson',
            data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/Ciclovias/FeatureServer/2/query?outFields=*&where=1%3D1&f=geojson'
        });

        map.addLayer({
          id: 'gira_markers',
          type: 'symbol',
          source: 'gira',
          layout: {
            'icon-image': 'gira_icon',
            'icon-size': 0.035,
            'icon-allow-overlap': true,
            'icon-ignore-placement': true,
            'visibility': 'none' // hide the layer by default
          }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/gira_icon.png', function(error, image) {
          if (error) throw error;
          map.addImage('gira_icon', image);
        });


        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'gira_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(feature.properties.NOME_RUA);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'gira_markers', function() {
            popup.remove();
        });


        // Mercados Lisboa
        map.addSource('mercados', {
            type: 'geojson',
            data: 'https://raw.githubusercontent.com/ManuelBanza/Artigos/main/15min/POIComprar.geojson'
        });

        map.addLayer({
            'id': 'mercados',
            'type': 'symbol',
            'source': 'mercados',
            'layout': {
              'icon-image': 'convenience-15',
              'icon-size': 1.1,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#008000'
            }
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'mercados', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(feature.properties.INF_NOME);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'mercados', function() {
            popup.remove();
        });


        // Loja do Cidadão
        map.addSource('loja_cidadao', {
            type: 'geojson',
            data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/POIServicos/FeatureServer/3/query?outFields=*&where=1%3D1&f=geojson'
        });

        map.addLayer({
            'id': 'loja_cidadao_markers',
            'type': 'symbol',
            'source': 'loja_cidadao',
            'layout': {
              'icon-image': 'loja_cidadao_icon',
              'icon-size': 0.2,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#008000'
            }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/loja_cidadao.png', function(error, image) {
          if (error) throw error;
          map.addImage('loja_cidadao_icon', image);
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'loja_cidadao_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(feature.properties.INF_NOME);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'loja_cidadao_markers', function() {
            popup.remove();
        });


        // Museus
        map.addSource('museus', {
            type: 'geojson',
            data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/POICultura/FeatureServer/3/query?outFields=*&where=1%3D1&f=geojson'
        });

        map.addLayer({
            'id': 'museus_markers',
            'type': 'symbol',
            'source': 'museus',
            'layout': {
              'icon-image': 'museus_icon',
              'icon-size': 0.04,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#008000'
            }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/museum_icon.png', function(error, image) {
          if (error) throw error;
          map.addImage('museus_icon', image);
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'museus_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(feature.properties.INF_NOME);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'museus_markers', function() {
            popup.remove();
        });


        // Teatros
        map.addSource('teatros', {
            type: 'geojson',
            data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/POICultura/FeatureServer/4/query?outFields=*&where=1%3D1&f=geojson'
        });

        map.addLayer({
            'id': 'teatros_markers',
            'type': 'symbol',
            'source': 'teatros',
            'layout': {
              'icon-image': 'teatros_icon',
              'icon-size': 0.04,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#008000'
            }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/teatro_icon.png', function(error, image) {
          if (error) throw error;
          map.addImage('teatros_icon', image);
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'teatros_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(feature.properties.INF_NOME);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'teatros_markers', function() {
            popup.remove();
        });

        // Salas de Desporto
        map.addSource('sala_desporto', {
            type: 'geojson',
            data: "https://manuelbanza.github.io/Artigos/15min/sala_desporto_pavilhao.geojson"
        });

        map.addLayer({
          id: 'sala_desporto_markers',
          type: 'symbol',
          source: 'sala_desporto',
          layout: {
            'icon-image': 'sala_desporto_icon',
            'icon-size': 0.035,
            'icon-allow-overlap': true,
            'icon-ignore-placement': true,
            'visibility': 'none' // hide the layer by default
          }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/sala_desporto.png', function(error, image) {
          if (error) throw error;
          map.addImage('sala_desporto_icon', image);
        });


        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'sala_desporto_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(`${feature.properties.DESIGNACAO}<br>${feature.properties.TIPOLOGIA}`);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'sala_desporto_markers', function() {
            popup.remove();
        });

        // Campo de Jogos
        map.addSource('campo_jogos', {
            type: 'geojson',
            data: "https://manuelbanza.github.io/Artigos/15min/campo_jogos.geojson"
        });

        map.addLayer({
          id: 'campo_jogos_markers',
          type: 'symbol',
          source: 'campo_jogos',
          layout: {
            'icon-image': 'campo_jogos_icon',
            'icon-size': 0.04,
            'icon-allow-overlap': true,
            'icon-ignore-placement': true,
            'visibility': 'none' // hide the layer by default
          }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/campo_jogos_icon_v3.png', function(error, image) {
          if (error) throw error;
          map.addImage('campo_jogos_icon', image);
        });


        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'campo_jogos_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(`${feature.properties.DESIGNACAO}<br>${feature.properties.TIPOLOGIA}`);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'campo_jogos_markers', function() {
            popup.remove();
        });


        // Outras Instalações Desportivas
        map.addSource('outras_desportivas', {
            type: 'geojson',
            data: "https://manuelbanza.github.io/Artigos/15min/Outras_Instalacoes.geojson"
        });

        map.addLayer({
          id: 'outras_desportivas_markers',
          type: 'symbol',
          source: 'outras_desportivas',
          layout: {
            'icon-image': 'outras_desportivas_icon',
            'icon-size': 0.07,
            'icon-allow-overlap': true,
            'icon-ignore-placement': true,
            'visibility': 'none' // hide the layer by default
          }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/outdoor_icon.png', function(error, image) {
          if (error) throw error;
          map.addImage('outras_desportivas_icon', image);
        });


        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'outras_desportivas_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(`${feature.properties.DESIGNACAO}<br>${feature.properties.TIPOLOGIA}`);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'outras_desportivas_markers', function() {
            popup.remove();
        });



        // Supermercado
        map.addSource('supermarket', {
            type: 'geojson',
            data: "https://manuelbanza.github.io/Artigos/15min/supermarket.geojson"
        });

        map.addLayer({
          id: 'supermarket_markers',
          type: 'symbol',
          source: 'supermarket',
          layout: {
            'icon-image': 'supermarket_icon',
            'icon-size': 0.035,
            'icon-allow-overlap': true,
            'icon-ignore-placement': true,
            'visibility': 'none' // hide the layer by default
          }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/supermarket_icon.png', function(error, image) {
          if (error) throw error;
          map.addImage('supermarket_icon', image);
        });


        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'supermarket_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(feature.properties.name);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'supermarket_markers', function() {
            popup.remove();
        });


        // Farmácias
        map.addSource('farmacias', {
            type: 'geojson',
            data: "https://manuelbanza.github.io/Artigos/15min/POIFarmacias.geojson"
        });

        map.addLayer({
          id: 'farmacias_markers',
          type: 'symbol',
          source: 'farmacias',
          layout: {
            'icon-image': 'farmacias_icon',
            'icon-size': 0.04,
            'icon-allow-overlap': true,
            'icon-ignore-placement': true,
            'visibility': 'none' // hide the layer by default
          }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/farmacia_logo.png', function(error, image) {
          if (error) throw error;
          map.addImage('farmacias_icon', image);
        });


        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'farmacias_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(feature.properties.INF_NOME);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'farmacias_markers', function() {
            popup.remove();
        });



        // Teatro em cada Bairro
        map.addSource('teatro_bairro', {
            type: 'geojson',
            data: "https://manuelbanza.github.io/Artigos/15min/teatro_bairro.geojson"
        });

        map.addLayer({
          id: 'teatro_bairro_markers',
          type: 'symbol',
          source: 'teatro_bairro',
          layout: {
            'icon-image': 'teatro_bairro_icon',
            'icon-size': 0.08,
            'icon-allow-overlap': true,
            'icon-ignore-placement': true,
            'visibility': 'none' // hide the layer by default
          }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/teatro_bairro_logo.png', function(error, image) {
          if (error) throw error;
          map.addImage('teatro_bairro_icon', image);
        });


        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'teatro_bairro_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(feature.properties.Nome);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'teatro_bairro_markers', function() {
            popup.remove();
        });


        // BiciParks
        map.addSource('biciparks', {
            type: 'geojson',
            data: "https://manuelbanza.github.io/Artigos/15min/bicipark.geojson"
        });

        map.addLayer({
          id: 'biciparks_markers',
          type: 'symbol',
          source: 'biciparks',
          layout: {
            'icon-image': 'bicipark_icon',
            'icon-size': 0.102,
            'icon-allow-overlap': true,
            'icon-ignore-placement': true,
            'visibility': 'none' // hide the layer by default
          }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/bicipark_logo.png', function(error, image) {
          if (error) throw error;
          map.addImage('bicipark_icon', image);
        });


        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'biciparks_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(feature.properties.parque);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'biciparks_markers', function() {
            popup.remove();
        });


        // Cinemas
        map.addSource('cinemas', {
            type: 'geojson',
            data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/POICultura/FeatureServer/2/query?outFields=*&where=1%3D1&f=geojson'
        });

        map.addLayer({
            'id': 'cinemas_markers',
            'type': 'symbol',
            'source': 'cinemas',
            'layout': {
              'icon-image': 'cinemas_icon',
              'icon-size': 0.02,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#008000'
            }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/cinema_icon.png', function(error, image) {
          if (error) throw error;
          map.addImage('cinemas_icon', image);
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'cinemas_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(feature.properties.INF_NOME);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'cinemas_markers', function() {
            popup.remove();
        });


        // LOjas CTT
        map.addSource('loja_ctt', {
            type: 'geojson',
            data: 'https://manuelbanza.github.io/Artigos/15min/ctt_location.geojson'
        });

        map.addLayer({
            'id': 'loja_ctt_markers',
            'type': 'symbol',
            'source': 'loja_ctt',
            'layout': {
              'icon-image': 'loja_ctt_icon',
              'icon-size': 0.07,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#008000'
            }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/ctt_logo.png', function(error, image) {
          if (error) throw error;
          map.addImage('loja_ctt_icon', image);
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'loja_ctt_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(`${feature.properties.name}<br>${feature.properties.formatted_address}`);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'creches_markers', function() {
            popup.remove();
        });


        // Creches
        map.addSource('creches', {
            type: 'geojson',
            data: 'https://manuelbanza.github.io/Artigos/15min/creches.geojson'
        });

        map.addLayer({
            'id': 'creches_markers',
            'type': 'symbol',
            'source': 'creches',
            'layout': {
              'icon-image': 'creches_icon',
              'icon-size': 0.04,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#008000'
            }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/creche_icon.png', function(error, image) {
          if (error) throw error;
          map.addImage('creches_icon', image);
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'creches_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(`${feature.properties.INF_NOME}<br>${feature.properties.Tipo}`);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'creches_markers', function() {
            popup.remove();
        });


        // Escolas
        map.addSource('escolas', {
            type: 'geojson',
            data: 'https://manuelbanza.github.io/Artigos/15min/escolas.geojson'
        });

        map.addLayer({
            'id': 'escolas_markers',
            'type': 'symbol',
            'source': 'escolas',
            'layout': {
              'icon-image': 'escolas_icon',
              'icon-size': 0.03,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#008000'
            }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/escola_icon2.png', function(error, image) {
          if (error) throw error;
          map.addImage('escolas_icon', image);
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'escolas_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(`${feature.properties.INF_NOME}<br>${feature.properties.Ciclo}<br>${feature.properties.Tipo}`);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'escolas_markers', function() {
            popup.remove();
        });


        // Criativo
        map.addSource('criativos', {
            type: 'geojson',
            data: 'https://manuelbanza.github.io/Artigos/15min/criativo.geojson'
        });

        map.addLayer({
            'id': 'criativos_markers',
            'type': 'symbol',
            'source': 'criativos',
            'layout': {
              'icon-image': 'criativos_icon',
              'icon-size': 0.08,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#008000'
            }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/criativo_icon.png', function(error, image) {
          if (error) throw error;
          map.addImage('criativos_icon', image);
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'criativos_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(`${feature.properties.NOME}<br>${feature.properties.TIPO}`);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'criativos_markers', function() {
            popup.remove();
        });


        // Hospital
        map.addSource('hospitais', {
            type: 'geojson',
            data: 'https://manuelbanza.github.io/Artigos/15min/hospitais.geojson'
        });

        map.addLayer({
            'id': 'hospitais_markers',
            'type': 'symbol',
            'source': 'hospitais',
            'layout': {
              'icon-image': 'hospitais_icon',
              'icon-size': 0.04,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#008000'
            }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/hospital_icon.png', function(error, image) {
          if (error) throw error;
          map.addImage('hospitais_icon', image);
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'hospitais_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(`${feature.properties.INF_NOME}<br>${feature.properties.Tipo}`);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'hospitais_markers', function() {
            popup.remove();
        });


        // Bibliotecas Municipais
        map.addSource('biblioteca', {
            type: 'geojson',
            data: 'https://manuelbanza.github.io/Artigos/15min/biblioteca.geojson'
        });

        map.addLayer({
            'id': 'biblioteca_markers',
            'type': 'symbol',
            'source': 'biblioteca',
            'layout': {
              'icon-image': 'hbiblioteca_icon',
              'icon-size': 0.04,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#008000'
            }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/biblioteca_icon.png', function(error, image) {
          if (error) throw error;
          map.addImage('hbiblioteca_icon', image);
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'biblioteca_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(`${feature.properties.INF_NOME}<br>${feature.properties.HORARIO}`);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'biblioteca_markers', function() {
            popup.remove();
        });


        // Bombeiros
        map.addSource('bombeiros', {
            type: 'geojson',
            data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/POISocorro/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson'
        });

        map.addLayer({
            'id': 'bombeiros_markers',
            'type': 'symbol',
            'source': 'bombeiros',
            'layout': {
              'icon-image': 'bombeiros_icon',
              'icon-size': 0.03,
              'icon-allow-overlap': true,
              'icon-ignore-placement': true,
              'visibility': 'none' // hide the layer by default
            },
            'paint': {
              'icon-color': '#008000'
            }
        });

        map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/bombeiros_icon.png', function(error, image) {
          if (error) throw error;
          map.addImage('bombeiros_icon', image);
        });

        // Add a popup to the map
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Listen for the mousemove event on the layer
        map.on('mousemove', 'bombeiros_markers', function(e) {
            // Get the first feature at the mouse location
            var feature = e.features[0];
            // Set the popup content to the value of the INF_NOME attribute
            popup.setHTML(`${feature.properties.NOME}<br>${feature.properties.TIPO}`);
            // Show the popup at the mouse location
            popup.setLngLat(e.lngLat).addTo(map);
        });

        // Remove the popup when the mouse leaves the layer
        map.on('mouseleave', 'bombeiros_markers', function() {
            popup.remove();
        });


        // Create a custom control to toggle the 'poi_saude' layer visibility
        class PoiSaudeToggleControl {
            onAdd(map) {
                // Create a container element for the control
                this.container = document.createElement('div');
                this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

                // Create a checkbox element to toggle the layer visibility
                this.checkbox = document.createElement('input');
                this.checkbox.type = 'checkbox';
                this.checkbox.id = 'poi_saude_toggle';
                this.checkbox.checked = false;
                this.container.appendChild(this.checkbox);

                // Create a label for the checkbox
                const label = document.createElement('label');
                label.htmlFor = 'poi_saude_toggle';
                label.textContent = 'Centros de Saúde';
                this.container.appendChild(label);

                // Add event listener to the checkbox
                this.checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        // Show the 'poi_saude' layer
                        map.setLayoutProperty('poi_saude_markers', 'visibility', 'visible');
                    } else {
                        // Hide the 'poi_saude' layer
                        map.setLayoutProperty('poi_saude_markers', 'visibility', 'none');
                    }
                });

                return this.container;
            }

            onRemove() {
                this.container.parentNode.removeChild(this.container);
                this.map = undefined;
            }
        }

        // Add the custom control to the map
        map.addControl(new PoiSaudeToggleControl(), 'top-right');


        // Create a custom control to toggle the 'poi_saude' layer visibility
        class HospitalToggleControl {
            onAdd(map) {
                // Create a container element for the control
                this.container = document.createElement('div');
                this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

                // Create a checkbox element to toggle the layer visibility
                this.checkbox = document.createElement('input');
                this.checkbox.type = 'checkbox';
                this.checkbox.id = 'hospitais_markers_toggle';
                this.checkbox.checked = false;
                this.container.appendChild(this.checkbox);

                // Create a label for the checkbox
                const label = document.createElement('label');
                label.htmlFor = 'hospitais_markers_toggle';
                label.textContent = 'Hospitais';
                this.container.appendChild(label);

                // Add event listener to the checkbox
                this.checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        // Show the 'poi_saude' layer
                        map.setLayoutProperty('hospitais_markers', 'visibility', 'visible');
                    } else {
                        // Hide the 'poi_saude' layer
                        map.setLayoutProperty('hospitais_markers', 'visibility', 'none');
                    }
                });

                return this.container;
            }

            onRemove() {
                this.container.parentNode.removeChild(this.container);
                this.map = undefined;
            }
        }

        // Add the custom control to the map
        map.addControl(new HospitalToggleControl(), 'top-right');


        // Create a custom control to toggle the 'poi_saude' layer visibility
        class CrechesToggleControl {
            onAdd(map) {
                // Create a container element for the control
                this.container = document.createElement('div');
                this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

                // Create a checkbox element to toggle the layer visibility
                this.checkbox = document.createElement('input');
                this.checkbox.type = 'checkbox';
                this.checkbox.id = 'creches_markers_toggle';
                this.checkbox.checked = false;
                this.container.appendChild(this.checkbox);

                // Create a label for the checkbox
                const label = document.createElement('label');
                label.htmlFor = 'creches_markers_toggle';
                label.textContent = 'Creches';
                this.container.appendChild(label);

                // Add event listener to the checkbox
                this.checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        // Show the 'poi_saude' layer
                        map.setLayoutProperty('creches_markers', 'visibility', 'visible');
                    } else {
                        // Hide the 'poi_saude' layer
                        map.setLayoutProperty('creches_markers', 'visibility', 'none');
                    }
                });

                return this.container;
            }

            onRemove() {
                this.container.parentNode.removeChild(this.container);
                this.map = undefined;
            }
        }

        // Add the custom control to the map
        map.addControl(new CrechesToggleControl(), 'top-right');


        // Create a custom control to toggle the 'poi_saude' layer visibility
        class EscolasToggleControl {
            onAdd(map) {
                // Create a container element for the control
                this.container = document.createElement('div');
                this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

                // Create a checkbox element to toggle the layer visibility
                this.checkbox = document.createElement('input');
                this.checkbox.type = 'checkbox';
                this.checkbox.id = 'escolas_markers_toggle';
                this.checkbox.checked = false;
                this.container.appendChild(this.checkbox);

                // Create a label for the checkbox
                const label = document.createElement('label');
                label.htmlFor = 'escolas_markers_toggle';
                label.textContent = 'Escolas';
                this.container.appendChild(label);

                // Add event listener to the checkbox
                this.checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        // Show the 'poi_saude' layer
                        map.setLayoutProperty('escolas_markers', 'visibility', 'visible');
                    } else {
                        // Hide the 'poi_saude' layer
                        map.setLayoutProperty('escolas_markers', 'visibility', 'none');
                    }
                });

                return this.container;
            }

            onRemove() {
                this.container.parentNode.removeChild(this.container);
                this.map = undefined;
            }
        }

        // Add the custom control to the map
        map.addControl(new EscolasToggleControl(), 'top-right');


    // Create a custom control to toggle the 'Univ' layer visibility
    class UnivToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'Univ_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'Univ_toggle';
            label.textContent = 'Universidades';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('Univ', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('Univ', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new UnivToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class CriativosToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'criativos_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'criativos_markers_toggle';
            label.textContent = 'Espaços de Inovação e Criação';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('criativos_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('criativos_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new CriativosToggleControl(), 'top-right');

    // Create a custom control to toggle the 'GIRA' layer visibility
    class GIRAToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'gira_toggle';
            this.checkbox.checked = false; // Hide the layer by default
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'gira_toggle';
            label.textContent = 'Estações GIRA';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'gira_markers' layer
                    map.setLayoutProperty('gira_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'gira_markers' layer
                    map.setLayoutProperty('gira_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new GIRAToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class BiciParkToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'biciparks_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'biciparks_markers_toggle';
            label.textContent = 'BiciParks';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('biciparks_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('biciparks_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new BiciParkToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class CicloviasToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'ciclovias_toggle';
            this.checkbox.checked = true;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'ciclovias_toggle';
            label.textContent = 'Ciclovias';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('ciclovias_lines', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('ciclovias_lines', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new CicloviasToggleControl(), 'top-right');



    // Create a custom control to toggle the 'Mercados' layer visibility
    class MercadosToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'mercados_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'mercados_toggle';
            label.textContent = 'Mercados Municipais';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('mercados', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('mercados', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new MercadosToggleControl(), 'top-right');



    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class LojaCidadaoToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'loja_cidadao_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'loja_cidadao_toggle';
            label.textContent = 'Loja Cidadão';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('loja_cidadao_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('loja_cidadao_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new LojaCidadaoToggleControl(), 'top-right');



    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class CTTToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'loja_ctt_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'loja_ctt_markers_toggle';
            label.textContent = 'Loja CTT';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('loja_ctt_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('loja_ctt_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new CTTToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class BibliotecasToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'biblioteca_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'biblioteca_markers_toggle';
            label.textContent = 'Bibliotecas Municipais';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('biblioteca_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('biblioteca_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new BibliotecasToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class MuseusToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'museus_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'museus_markers_toggle';
            label.textContent = 'Museus';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('museus_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('museus_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new MuseusToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class TeatrosToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'teatros_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'teatros_markers_toggle';
            label.textContent = 'Teatros';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('teatros_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('teatros_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new TeatrosToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class TeatrosBairroToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'teatro_bairro_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'teatro_bairro_markers_toggle';
            label.textContent = 'Um Teatro em cada Bairro';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('teatro_bairro_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('teatro_bairro_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new TeatrosBairroToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class CinemasToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'cinemas_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'cinemas_markers_toggle';
            label.textContent = 'Cinemas';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('cinemas_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('cinemas_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new CinemasToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class SalasDesportoToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'sala_desporto_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'sala_desporto_markers_toggle';
            label.textContent = 'Salas de Desporto e Pavilhões Desportivos';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('sala_desporto_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('sala_desporto_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new SalasDesportoToggleControl(), 'top-right');




    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class CampoJogosToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'campo_jogos_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'campo_jogos_markers_toggle';
            label.textContent = 'Campo de Jogos';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('campo_jogos_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('campo_jogos_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new CampoJogosToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class OutrasDesportivasToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'outras_desportivas_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'outras_desportivas_markers_toggle';
            label.textContent = 'Outras Instalações Desportivas ';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('outras_desportivas_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('outras_desportivas_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new OutrasDesportivasToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class SupermercadosToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'supermarket_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'supermarket_markers_toggle';
            label.textContent = 'Supermercados';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('supermarket_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('supermarket_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new SupermercadosToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class FarmaciasToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'farmacias_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'farmacias_markers_toggle';
            label.textContent = 'Farmácias';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('farmacias_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('farmacias_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new FarmaciasToggleControl(), 'top-right');


    // Create a custom control to toggle the 'loja_cidadao' layer visibility
    class BombeirosToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'bombeiros_markers_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'bombeiros_markers_toggle';
            label.textContent = 'Bombeiros';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('bombeiros_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('bombeiros_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new BombeirosToggleControl(), 'top-right');



        // Make the API call
        getIso();

        // Do this when the geocoder returns a result
        geocoder.on("result", ev => {
          coords = ev.result.geometry.coordinates.join(",");
          console.log(coords);
          getIso();
        });

        // Fetch the point geojson and set it to a map layer source
        fetch(pointsUrl).then(res => res.json()).then(res => {
          points = res;
          map.getSource("points").setData(points);
        });

        getIso();


  });
    </script>
  </body>
</html>
