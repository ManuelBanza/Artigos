<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Cidade dos 15 Minutos</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.css" rel="stylesheet" />
<style>
	body { margin: 0; padding: 0; }
	#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css" type="text/css"/>
<script src="https://unpkg.com/@turf/turf/turf.min.js"></script>

<div id="map"></div>

<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoibWFudWVsYmFuemEiLCJhIjoiY2syYzA0NGV0MDcxcTNjbGNlODY4NDR1ZyJ9.SUXHI1TRqNXKr3uPFzgNjQ';
  const transformRequest = (url) => {
    const hasQuery = url.indexOf("?") !== -1;
    const suffix = hasQuery ? "&pluginName=lunchboxIsochrones" : "?pluginName=lunchboxIsochrones";
    return {
      url: url + suffix
    }
  }
  
  const isoUrl = "https://api.mapbox.com/isochrone/v1/mapbox";
  const profile = "walking";
  const minutes = "15";
  let coords = "-9.1375946,38.7331092";

  const pointsUrl = "https://gist.githubusercontent.com/jbranigan/f01464d691d39e59bdbf2a4e3d61d7b7/raw/e92e84fc03189830bd45802138edea2a41b4e5f6/hospitals.geojson";
  let points = {};
  
  const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [-9.1375946,38.7331092],
      zoom: 12.1,
      transformRequest: transformRequest
  });

  const geocoder = new MapboxGeocoder({
    accessToken: mapboxgl.accessToken,
    mapboxgl: mapboxgl
  });

  map.addControl(geocoder, "top-right");

  const getIso = function() {

    // Concatenate the request
    let request = `${isoUrl}/${profile}/${coords}.json?contours_minutes=${minutes}&polygons=true&access_token=${mapboxgl.accessToken}`;

    // Make the request, then do the things
    fetch(request).then(res => res.json()).then(res => {
      map.getSource("iso").setData(res);
      
      const selected = turf.pointsWithinPolygon(points, res);
      map.getSource("selection").setData(selected);
      
      const selectionCount = selected.features.length;
      console.log(`Number of points within ${minutes} minutes ${profile} of ${coords}: ${selectionCount}`);
    });
    
  };

  map.on("load", () => {
    // Add source and layer for the isochrone
    map.addSource("iso", {
      type: "geojson",
      data: {
        type: "FeatureCollection",
        features: [
        ]
      }
    });

    map.addLayer({
      "id": "isoLayer",
      "type": "fill",
      "source": "iso",
      "layout": {},
      "paint": {
        "fill-color": "purple",
        "fill-opacity": 0.18
      }
    }, "poi-label");

    // Add source and layer for the point data
    map.addSource("points", {
      type: "geojson",
      data: {
        type: "FeatureCollection",
        features: [
        ]
      }
    });

    map.addLayer({
      "id": "pointsLayer",
      "type": "circle",
      "source": "points",
      "layout": {},
      "paint": {
        "circle-color": "blue",
      }
    }, "poi-label");

    // Add source and layer for the selected point data
    map.addSource("selection", {
      type: "geojson",
      data: {
        type: "FeatureCollection",
        features: [
        ]
      }
    });

    map.addLayer({
      "id": "selectionLayer",
      "type": "circle",
      "source": "selection",
      "layout": {},
      "paint": {
        "circle-color": "purple",
      }
    });

    // Ciclovias
    map.addSource('ciclovias', {
        type: 'geojson',
        data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/Ciclovias/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson'
    });

    map.addLayer({
        'id': 'ciclovias_lines',
        'type': 'line',
        'source': 'ciclovias',
        'layout': {
            'line-join': 'round',
            'line-cap': 'round',
        },
        'paint': {
            'line-color': '#008000',
            'line-width': 1.5
        }
    });

    // Add a popup to the map
    var popup = new mapboxgl.Popup({
        closeButton: false,
        closeOnClick: false
    });

    // Listen for the mousemove event on the layer
    map.on('mousemove', 'ciclovias_lines', function(e) {
        // Get the first feature at the mouse location
        var feature = e.features[0];
        // Set the popup content to the value of the INF_NOME attribute
        popup.setHTML(feature.properties.TIPOLOGIA);
        // Show the popup at the mouse location
        popup.setLngLat(e.lngLat).addTo(map);
    });

    // Remove the popup when the mouse leaves the layer
    map.on('mouseleave', 'ciclovias_lines', function() {
        popup.remove();
    });


    // Clinicas de Saude
    map.addSource('poi_saude', {
        type: 'geojson',
        data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/POISaude/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson'
    });

    map.addLayer({
        'id': 'poi_saude_markers',
        'type': 'symbol',
        'source': 'poi_saude',
        'layout': {
          'icon-image': 'clinica_saude_icon',
          'icon-size': 0.042,
          'icon-allow-overlap': true,
          'icon-ignore-placement': true,
          'visibility': 'none' // hide the layer by default
        },
        'paint': {
          'icon-color': '#fff'
        }
    });

    map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/clinica_saude.png', function(error, image) {
      if (error) throw error;
      map.addImage('clinica_saude_icon', image);
    });

    // Add a popup to the map
    var popup = new mapboxgl.Popup({
        closeButton: false,
        closeOnClick: false
    });

    // Listen for the mousemove event on the layer
    map.on('mousemove', 'poi_saude_markers', function(e) {
        // Get the first feature at the mouse location
        var feature = e.features[0];
        // Set the popup content to the value of the INF_NOME attribute
        popup.setHTML(feature.properties.INF_NOME);
        // Show the popup at the mouse location
        popup.setLngLat(e.lngLat).addTo(map);
    });

    // Remove the popup when the mouse leaves the layer
    map.on('mouseleave', 'poi_saude_markers', function() {
        popup.remove();
    });




    // Define the source for the Univ layer
    map.addSource('Univ', {
      type: 'geojson',
      data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/POIEducacao/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson'
      });

    // Add the Univ layer to the map
    map.addLayer({
      'id': 'Univ',
      'type': 'symbol',
      'source': 'Univ',
      'layout': {
          'icon-image': 'college-15',
          'icon-size': 0.8,
          'icon-allow-overlap': true,
          'icon-ignore-placement': true,
          'visibility': 'none' // hide the layer by default
        },
        'paint': {
          'icon-color': '#fff'
        }
    });


    // Add a popup to the map
    var popup = new mapboxgl.Popup({
        closeButton: false,
        closeOnClick: false
    });

    // Listen for the mousemove event on the layer
    map.on('mousemove', 'Univ', function(e) {
        // Get the first feature at the mouse location
        var feature = e.features[0];
        // Set the popup content to the value of the NOME attribute
        popup.setHTML(feature.properties.INF_NOME);
        // Show the popup at the mouse location
        popup.setLngLat(e.lngLat).addTo(map);
    });

    // Remove the popup when the mouse leaves the layer
    map.on('mouseleave', 'Univ', function() {
        popup.remove();
    });


    // GIRA
    map.addSource('gira', {
        type: 'geojson',
        data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/Ciclovias/FeatureServer/2/query?outFields=*&where=1%3D1&f=geojson'
    });

    map.addLayer({
      id: 'gira_markers',
      type: 'symbol',
      source: 'gira',
      layout: {
        'icon-image': 'gira_icon',
        'icon-size': 0.035,
        'icon-allow-overlap': true,
        'icon-ignore-placement': true,
        'visibility': 'none' // hide the layer by default
      }
    });

    map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/gira_icon.png', function(error, image) {
      if (error) throw error;
      map.addImage('gira_icon', image);
    });


    // Add a popup to the map
    var popup = new mapboxgl.Popup({
        closeButton: false,
        closeOnClick: false
    });

    // Listen for the mousemove event on the layer
    map.on('mousemove', 'gira_markers', function(e) {
        // Get the first feature at the mouse location
        var feature = e.features[0];
        // Set the popup content to the value of the INF_NOME attribute
        popup.setHTML(feature.properties.NOME_RUA);
        // Show the popup at the mouse location
        popup.setLngLat(e.lngLat).addTo(map);
    });

    // Remove the popup when the mouse leaves the layer
    map.on('mouseleave', 'gira_markers', function() {
        popup.remove();
    });


    // Mercados Lisboa
    map.addSource('mercados', {
        type: 'geojson',
        data: 'https://raw.githubusercontent.com/ManuelBanza/Artigos/main/15min/POIComprar.geojson'
    });

    map.addLayer({
        'id': 'mercados',
        'type': 'symbol',
        'source': 'mercados',
        'layout': {
          'icon-image': 'convenience-15',
          'icon-size': 1.1,
          'icon-allow-overlap': true,
          'icon-ignore-placement': true,
          'visibility': 'none' // hide the layer by default
        },
        'paint': {
          'icon-color': '#008000'
        }
    });

    // Add a popup to the map
    var popup = new mapboxgl.Popup({
        closeButton: false,
        closeOnClick: false
    });

    // Listen for the mousemove event on the layer
    map.on('mousemove', 'mercados', function(e) {
        // Get the first feature at the mouse location
        var feature = e.features[0];
        // Set the popup content to the value of the INF_NOME attribute
        popup.setHTML(feature.properties.INF_NOME);
        // Show the popup at the mouse location
        popup.setLngLat(e.lngLat).addTo(map);
    });

    // Remove the popup when the mouse leaves the layer
    map.on('mouseleave', 'mercados', function() {
        popup.remove();
    });


    // Loja do Cidadão
    map.addSource('loja_cidadao', {
        type: 'geojson',
        data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/POIServicos/FeatureServer/3/query?outFields=*&where=1%3D1&f=geojson'
    });

    map.addLayer({
        'id': 'loja_cidadao_markers',
        'type': 'symbol',
        'source': 'loja_cidadao',
        'layout': {
          'icon-image': 'loja_cidadao_icon',
          'icon-size': 0.2,
          'icon-allow-overlap': true,
          'icon-ignore-placement': true,
          'visibility': 'none' // hide the layer by default
        },
        'paint': {
          'icon-color': '#008000'
        }
    });

    map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/loja_cidadao.png', function(error, image) {
      if (error) throw error;
      map.addImage('loja_cidadao_icon', image);
    });

    // Add a popup to the map
    var popup = new mapboxgl.Popup({
        closeButton: false,
        closeOnClick: false
    });

    // Listen for the mousemove event on the layer
    map.on('mousemove', 'loja_cidadao_markers', function(e) {
        // Get the first feature at the mouse location
        var feature = e.features[0];
        // Set the popup content to the value of the INF_NOME attribute
        popup.setHTML(feature.properties.INF_NOME);
        // Show the popup at the mouse location
        popup.setLngLat(e.lngLat).addTo(map);
    });

    // Remove the popup when the mouse leaves the layer
    map.on('mouseleave', 'loja_cidadao_markers', function() {
        popup.remove();
    });


    // Museus
    map.addSource('museus', {
        type: 'geojson',
        data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/POICultura/FeatureServer/3/query?outFields=*&where=1%3D1&f=geojson'
    });

    map.addLayer({
        'id': 'museus_markers',
        'type': 'symbol',
        'source': 'museus',
        'layout': {
          'icon-image': 'museus_icon',
          'icon-size': 0.04,
          'icon-allow-overlap': true,
          'icon-ignore-placement': true,
          'visibility': 'none' // hide the layer by default
        },
        'paint': {
          'icon-color': '#008000'
        }
    });

    map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/museum_icon.png', function(error, image) {
      if (error) throw error;
      map.addImage('museus_icon', image);
    });

    // Add a popup to the map
    var popup = new mapboxgl.Popup({
        closeButton: false,
        closeOnClick: false
    });

    // Listen for the mousemove event on the layer
    map.on('mousemove', 'museus_markers', function(e) {
        // Get the first feature at the mouse location
        var feature = e.features[0];
        // Set the popup content to the value of the INF_NOME attribute
        popup.setHTML(feature.properties.INF_NOME);
        // Show the popup at the mouse location
        popup.setLngLat(e.lngLat).addTo(map);
    });

    // Remove the popup when the mouse leaves the layer
    map.on('mouseleave', 'museus_markers', function() {
        popup.remove();
    });


    // Teatros
    map.addSource('teatros', {
        type: 'geojson',
        data: 'https://services.arcgis.com/1dSrzEWVQn5kHHyK/arcgis/rest/services/POICultura/FeatureServer/4/query?outFields=*&where=1%3D1&f=geojson'
    });

    map.addLayer({
        'id': 'teatros_markers',
        'type': 'symbol',
        'source': 'teatros',
        'layout': {
          'icon-image': 'teatros_icon',
          'icon-size': 0.04,
          'icon-allow-overlap': true,
          'icon-ignore-placement': true,
          'visibility': 'none' // hide the layer by default
        },
        'paint': {
          'icon-color': '#008000'
        }
    });

    map.loadImage('https://manuelbanza.github.io/Artigos/15min/icons/teatro_icon.png', function(error, image) {
      if (error) throw error;
      map.addImage('teatros_icon', image);
    });

    // Add a popup to the map
    var popup = new mapboxgl.Popup({
        closeButton: false,
        closeOnClick: false
    });

    // Listen for the mousemove event on the layer
    map.on('mousemove', 'teatros_markers', function(e) {
        // Get the first feature at the mouse location
        var feature = e.features[0];
        // Set the popup content to the value of the INF_NOME attribute
        popup.setHTML(feature.properties.INF_NOME);
        // Show the popup at the mouse location
        popup.setLngLat(e.lngLat).addTo(map);
    });

    // Remove the popup when the mouse leaves the layer
    map.on('mouseleave', 'teatros_markers', function() {
        popup.remove();
    });

    
    // Do this when the geocoder returns a result
    geocoder.on("result", ev => {
      coords = ev.result.geometry.coordinates.join(",");
      console.log(coords);
      getIso();
    });

    // Fetch the point geojson and set it to a map layer source
    fetch(pointsUrl).then(res => res.json()).then(res => {
      points = res;
      map.getSource("points").setData(points);
    });

    getIso();
    
    
    // Create a custom control to toggle the 'poi_saude' layer visibility
    class PoiSaudeToggleControl {
        onAdd(map) {
            // Create a container element for the control
            this.container = document.createElement('div');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

            // Create a checkbox element to toggle the layer visibility
            this.checkbox = document.createElement('input');
            this.checkbox.type = 'checkbox';
            this.checkbox.id = 'poi_saude_toggle';
            this.checkbox.checked = false;
            this.container.appendChild(this.checkbox);

            // Create a label for the checkbox
            const label = document.createElement('label');
            label.htmlFor = 'poi_saude_toggle';
            label.textContent = 'Centros de Saúde';
            this.container.appendChild(label);

            // Add event listener to the checkbox
            this.checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show the 'poi_saude' layer
                    map.setLayoutProperty('poi_saude_markers', 'visibility', 'visible');
                } else {
                    // Hide the 'poi_saude' layer
                    map.setLayoutProperty('poi_saude_markers', 'visibility', 'none');
                }
            });

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Add the custom control to the map
    map.addControl(new PoiSaudeToggleControl(), 'top-right');


// Create a custom control to toggle the 'Univ' layer visibility
class UnivToggleControl {
    onAdd(map) {
        // Create a container element for the control
        this.container = document.createElement('div');
        this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

        // Create a checkbox element to toggle the layer visibility
        this.checkbox = document.createElement('input');
        this.checkbox.type = 'checkbox';
        this.checkbox.id = 'Univ_toggle';
        this.checkbox.checked = false;
        this.container.appendChild(this.checkbox);

        // Create a label for the checkbox
        const label = document.createElement('label');
        label.htmlFor = 'Univ_toggle';
        label.textContent = 'Universidades';
        this.container.appendChild(label);

        // Add event listener to the checkbox
        this.checkbox.addEventListener('change', function() {
            if (this.checked) {
                // Show the 'poi_saude' layer
                map.setLayoutProperty('Univ', 'visibility', 'visible');
            } else {
                // Hide the 'poi_saude' layer
                map.setLayoutProperty('Univ', 'visibility', 'none');
            }
        });

        return this.container;
    }

    onRemove() {
        this.container.parentNode.removeChild(this.container);
        this.map = undefined;
    }
}

// Add the custom control to the map
map.addControl(new UnivToggleControl(), 'top-right');

// Create a custom control to toggle the 'GIRA' layer visibility
class GIRAToggleControl {
    onAdd(map) {
        // Create a container element for the control
        this.container = document.createElement('div');
        this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

        // Create a checkbox element to toggle the layer visibility
        this.checkbox = document.createElement('input');
        this.checkbox.type = 'checkbox';
        this.checkbox.id = 'gira_toggle';
        this.checkbox.checked = false; // Hide the layer by default
        this.container.appendChild(this.checkbox);

        // Create a label for the checkbox
        const label = document.createElement('label');
        label.htmlFor = 'gira_toggle';
        label.textContent = 'Estações GIRA';
        this.container.appendChild(label);

        // Add event listener to the checkbox
        this.checkbox.addEventListener('change', function() {
            if (this.checked) {
                // Show the 'gira_markers' layer
                map.setLayoutProperty('gira_markers', 'visibility', 'visible');
            } else {
                // Hide the 'gira_markers' layer
                map.setLayoutProperty('gira_markers', 'visibility', 'none');
            }
        });

        return this.container;
    }

    onRemove() {
        this.container.parentNode.removeChild(this.container);
        this.map = undefined;
    }
}

// Add the custom control to the map
map.addControl(new GIRAToggleControl(), 'top-right');



// Create a custom control to toggle the 'Mercados' layer visibility
class MercadosToggleControl {
    onAdd(map) {
        // Create a container element for the control
        this.container = document.createElement('div');
        this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

        // Create a checkbox element to toggle the layer visibility
        this.checkbox = document.createElement('input');
        this.checkbox.type = 'checkbox';
        this.checkbox.id = 'mercados_toggle';
        this.checkbox.checked = false;
        this.container.appendChild(this.checkbox);

        // Create a label for the checkbox
        const label = document.createElement('label');
        label.htmlFor = 'mercados_toggle';
        label.textContent = 'Mercados';
        this.container.appendChild(label);

        // Add event listener to the checkbox
        this.checkbox.addEventListener('change', function() {
            if (this.checked) {
                // Show the 'poi_saude' layer
                map.setLayoutProperty('mercados', 'visibility', 'visible');
            } else {
                // Hide the 'poi_saude' layer
                map.setLayoutProperty('mercados', 'visibility', 'none');
            }
        });

        return this.container;
    }

    onRemove() {
        this.container.parentNode.removeChild(this.container);
        this.map = undefined;
    }
}

// Add the custom control to the map
map.addControl(new MercadosToggleControl(), 'top-right');



// Create a custom control to toggle the 'loja_cidadao' layer visibility
class LojaCidadaoToggleControl {
    onAdd(map) {
        // Create a container element for the control
        this.container = document.createElement('div');
        this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

        // Create a checkbox element to toggle the layer visibility
        this.checkbox = document.createElement('input');
        this.checkbox.type = 'checkbox';
        this.checkbox.id = 'loja_cidadao_toggle';
        this.checkbox.checked = false;
        this.container.appendChild(this.checkbox);

        // Create a label for the checkbox
        const label = document.createElement('label');
        label.htmlFor = 'loja_cidadao_toggle';
        label.textContent = 'Loja Cidadão';
        this.container.appendChild(label);

        // Add event listener to the checkbox
        this.checkbox.addEventListener('change', function() {
            if (this.checked) {
                // Show the 'poi_saude' layer
                map.setLayoutProperty('loja_cidadao_markers', 'visibility', 'visible');
            } else {
                // Hide the 'poi_saude' layer
                map.setLayoutProperty('loja_cidadao_markers', 'visibility', 'none');
            }
        });

        return this.container;
    }

    onRemove() {
        this.container.parentNode.removeChild(this.container);
        this.map = undefined;
    }
}

// Add the custom control to the map
map.addControl(new LojaCidadaoToggleControl(), 'top-right');


// Create a custom control to toggle the 'loja_cidadao' layer visibility
class CicloviasToggleControl {
    onAdd(map) {
        // Create a container element for the control
        this.container = document.createElement('div');
        this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

        // Create a checkbox element to toggle the layer visibility
        this.checkbox = document.createElement('input');
        this.checkbox.type = 'checkbox';
        this.checkbox.id = 'ciclovias_toggle';
        this.checkbox.checked = true;
        this.container.appendChild(this.checkbox);

        // Create a label for the checkbox
        const label = document.createElement('label');
        label.htmlFor = 'ciclovias_toggle';
        label.textContent = 'Ciclovias';
        this.container.appendChild(label);

        // Add event listener to the checkbox
        this.checkbox.addEventListener('change', function() {
            if (this.checked) {
                // Show the 'poi_saude' layer
                map.setLayoutProperty('ciclovias_lines', 'visibility', 'visible');
            } else {
                // Hide the 'poi_saude' layer
                map.setLayoutProperty('ciclovias_lines', 'visibility', 'none');
            }
        });

        return this.container;
    }

    onRemove() {
        this.container.parentNode.removeChild(this.container);
        this.map = undefined;
    }
}

// Add the custom control to the map
map.addControl(new CicloviasToggleControl(), 'top-right');


// Create a custom control to toggle the 'loja_cidadao' layer visibility
class MuseusToggleControl {
    onAdd(map) {
        // Create a container element for the control
        this.container = document.createElement('div');
        this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

        // Create a checkbox element to toggle the layer visibility
        this.checkbox = document.createElement('input');
        this.checkbox.type = 'checkbox';
        this.checkbox.id = 'museus_markers_toggle';
        this.checkbox.checked = false;
        this.container.appendChild(this.checkbox);

        // Create a label for the checkbox
        const label = document.createElement('label');
        label.htmlFor = 'museus_markers_toggle';
        label.textContent = 'Museus';
        this.container.appendChild(label);

        // Add event listener to the checkbox
        this.checkbox.addEventListener('change', function() {
            if (this.checked) {
                // Show the 'poi_saude' layer
                map.setLayoutProperty('museus_markers', 'visibility', 'visible');
            } else {
                // Hide the 'poi_saude' layer
                map.setLayoutProperty('museus_markers', 'visibility', 'none');
            }
        });

        return this.container;
    }

    onRemove() {
        this.container.parentNode.removeChild(this.container);
        this.map = undefined;
    }
}

// Add the custom control to the map
map.addControl(new MuseusToggleControl(), 'top-right');


// Create a custom control to toggle the 'loja_cidadao' layer visibility
class TeatrosToggleControl {
    onAdd(map) {
        // Create a container element for the control
        this.container = document.createElement('div');
        this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

        // Create a checkbox element to toggle the layer visibility
        this.checkbox = document.createElement('input');
        this.checkbox.type = 'checkbox';
        this.checkbox.id = 'teatros_markers_toggle';
        this.checkbox.checked = false;
        this.container.appendChild(this.checkbox);

        // Create a label for the checkbox
        const label = document.createElement('label');
        label.htmlFor = 'teatros_markers_toggle';
        label.textContent = 'Teatros';
        this.container.appendChild(label);

        // Add event listener to the checkbox
        this.checkbox.addEventListener('change', function() {
            if (this.checked) {
                // Show the 'poi_saude' layer
                map.setLayoutProperty('teatros_markers', 'visibility', 'visible');
            } else {
                // Hide the 'poi_saude' layer
                map.setLayoutProperty('teatros_markers', 'visibility', 'none');
            }
        });

        return this.container;
    }

    onRemove() {
        this.container.parentNode.removeChild(this.container);
        this.map = undefined;
    }
}

// Add the custom control to the map
map.addControl(new TeatrosToggleControl(), 'top-right');


  });
</script>

</body>
</html>